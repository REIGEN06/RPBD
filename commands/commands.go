package commands

import (
	"buy-list/storage/postgresql"
	"strconv"
	"strings"
)

func CommandHandler(user_msg string, user_id int64, chat_id int64, user_nickname string, user_name string, db *postgresql.Connection) string {
	msg := "–ö–æ–º–∞–Ω–¥–∞ –Ω–µ —Ä–∞—Å–ø–æ–∑–Ω–∞–Ω–∞"
	if user_msg == "/help" || user_msg == "/start" {
		msg = "üò≥–í–ê–ñ–ù–ûüò≥ –ü–µ—Ä–µ–¥ —Ç–µ–º, –∫–∞–∫ –≤–ø–µ—Ä–≤—ã–µ –≤–æ—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å—Å—è –±–æ—Ç–æ–º, –≤–∞–º –Ω—É–∂–Ω–æ –Ω–∞–ø–∏—Å–∞—Ç—å –∫–æ–º–∞–Ω–¥—É /reg, —á—Ç–æ–±—ã –±–æ—Ç –≤–∞—Å –∑–∞–ø–æ–º–Ω–∏–ª.\n\n–ù–∞–∂–º–∏—Ç–µ '/' –∏–ª–∏ –Ω–∞ –∫–Ω–æ–ø–∫—É '–ú–µ–Ω—é' —Å–ª–µ–≤–∞ –≤–Ω–∏–∑—É, —á—Ç–æ–±—ã —É–≤–∏–¥–µ—Ç—å –¥–æ—Å—Ç—É–ø–Ω—ã–µ –∫–æ–º–∞–Ω–¥—ã"
		return msg
	} else if user_msg == "/reg" {
		msg = db.CreateUser(user_nickname, user_name, user_id, chat_id)
		return msg
	} else if user_msg == "/addinlist" {
		msg = "–í–≤–µ–¥–∏—Ç–µ –Ω–∞–∑–≤–∞–Ω–∏–µ –ø—Ä–æ–¥—É–∫—Ç–∞(–æ–¥–Ω–∏–º —Å–ª–æ–≤–æ–º), –≤–µ—Å(–≤ –≥—Ä–∞–º–º–∞—Ö) –∏ –¥–∞—Ç—É –Ω–∞–ø–æ–º–∏–Ω–∞–Ω–∏—è —á–µ—Ä–µ–∑ –ø—Ä–æ–±–µ–ª\n–ü—Ä–∏–º–µ—Ä: –ß–∏–ø—Å—ã 80 31-01-2023 09:00\n\n–õ–∏–±–æ –ø—Ä–æ—Å—Ç–æ –≤–≤–µ–¥–∏—Ç–µ –Ω–∞–∑–≤–∞–Ω–∏–µ –ø—Ä–æ–¥—É–∫—Ç–∞üòä"
		db.SetStatus(1, user_id, chat_id)
		return msg
	} else if user_msg == "/addinfridge" {
		msg = "–ï—Å–ª–∏ –≤—ã —Ö–æ—Ç–∏—Ç–µ –ø–µ—Ä–µ–Ω–µ—Å—Ç–∏ –ø—Ä–æ–¥—É–∫—Ç –∏–∑ —Å–ø–∏—Å–∫–∞ –ø—Ä–æ–¥—É–∫—Ç–æ–≤ –≤ —Ö–æ–ª–æ–¥–∏–ª—å–Ω–∏–∫, —Ç–æ –≤–≤–µ–¥–∏—Ç–µ '–∫—É–ø–∏–ª', –Ω–∞–∑–≤–∞–Ω–∏–µ –ø—Ä–æ–¥—É–∫—Ç–∞(–æ–¥–Ω–∏–º —Å–ª–æ–≤–æ–º) –∏ —Å—Ä–æ–∫ —Ö—Ä–∞–Ω–µ–Ω–∏—è —á–µ—Ä–µ–∑ –ø—Ä–æ–±–µ–ª\n–ü—Ä–∏–º–µ—Ä: –∫—É–ø–∏–ª –ß–∏–ø—Å—ã 31-01-2022 31-01-2023\n\n–ï—Å–ª–∏ –∂–µ –≤—ã —Ö–æ—Ç–∏—Ç–µ –¥–æ–±–∞–≤–∏—Ç—å –Ω–æ–≤—ã–π –ø—Ä–æ–¥—É–∫—Ç –≤ —Ö–æ–ª–æ–¥–∏–ª—å–Ω–∏–∫, —Ç–æ –≤–≤–µ–¥–∏—Ç–µ –Ω–∞–∑–≤–∞–Ω–∏–µ –ø—Ä–æ–¥—É–∫—Ç–∞ –∏ —Å—Ä–æ–∫ —Ö—Ä–∞–Ω–µ–Ω–∏—è —á–µ—Ä–µ–∑ –ø—Ä–æ–±–µ–ª\n–ü—Ä–∏–º–µ—Ä: –ß–∏–ø—Å—ã 31-01-2022 31-01-2023\n\n–†–µ–≥–∏—Å—Ç—Ä –≤–∞–∂–µ–Ω! (—Ö–ª–µ–± –∏ –•–ª–µ–± —ç—Ç–æ —Ä–∞–∑–Ω—ã–µ –ø—Ä–æ–¥—É–∫—Ç—ã)"
		db.SetStatus(2, user_id, chat_id)
		return msg
	} else if user_msg == "/open" {
		msg = "–í–≤–µ–¥–∏—Ç–µ –Ω–∞–∑–≤–∞–Ω–∏–µ –ø—Ä–æ–¥—É–∫—Ç–∞(–æ–¥–Ω–∏–º —Å–ª–æ–≤–æ–º), –∫–æ—Ç–æ—Ä—ã–π –≤—ã –æ—Ç–∫—Ä—ã–ª–∏ –∏ –Ω–æ–≤—ã–π —Å—Ä–æ–∫ —Ö—Ä–∞–Ω–µ–Ω–∏—è\n–ü—Ä–∏–º–µ—Ä: –ß–∏–ø—Å—ã 24-01-2022 31-01-2023\n\n–†–µ–≥–∏—Å—Ç—Ä –≤–∞–∂–µ–Ω! (—Ö–ª–µ–± –∏ –•–ª–µ–± —ç—Ç–æ —Ä–∞–∑–Ω—ã–µ –ø—Ä–æ–¥—É–∫—Ç—ã)"
		db.SetStatus(3, user_id, chat_id)
		return msg
	} else if user_msg == "/finish" {
		msg = "–í–≤–µ–¥–∏—Ç–µ –Ω–∞–∑–≤–∞–Ω–∏–µ –ø—Ä–æ–¥—É–∫—Ç–∞(–æ–¥–Ω–∏–º —Å–ª–æ–≤–æ–º), –∫–æ—Ç–æ—Ä—ã–π –≤—ã –ø—Ä–∏–≥–æ—Ç–æ–≤–∏–ª–∏/–≤—ã–±—Ä–æ—Å–∏–ª–∏\n\n–†–µ–≥–∏—Å—Ç—Ä –≤–∞–∂–µ–Ω! (—Ö–ª–µ–± –∏ –•–ª–µ–± —ç—Ç–æ —Ä–∞–∑–Ω—ã–µ –ø—Ä–æ–¥—É–∫—Ç—ã)"
		db.SetStatus(4, user_id, chat_id)
		return msg
	} else if user_msg == "/list" {
		msg = "–í–≤–µ–¥–∏—Ç–µ —Ü–∏—Ñ—Ä—É —Å–æ—Ä—Ç–∏—Ä–æ–≤–∫–∏ —Å–ø–∏—Å–∫–∞ –ø—Ä–æ–¥—É–∫—Ç–æ–≤: \n1.–ü–æ –∞–ª—Ñ–∞–≤–∏—Ç—É [–°–ø–∏—Å–æ–∫ –ø–æ–∫—É–ø–æ–∫]\n2.–ü–æ –∏—Å—Ç–µ—á–µ–Ω–∏—é —Å—Ä–æ–∫–∞ –≥–æ–¥–Ω–æ—Å—Ç–∏ [–•–æ–ª–æ–¥–∏–ª—å–Ω–∏–∫]\n3.–°–ø–∏—Å–æ–∫ –≤—Å–µ—Ö –ø—Ä–æ–¥—É–∫—Ç–æ–≤"
		db.SetStatus(5, user_id, chat_id)
		return msg
	} else if user_msg == "/listused" {
		msg = "–°–ø–∏—Å–æ–∫ —Ä–∞–Ω–µ–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–Ω—ã—Ö –ø—Ä–æ–¥—É–∫—Ç–æ–≤"
		products, _ := db.GetList(user_id, chat_id, 4)
		for i := 0; i < len(products); i++ {
			msg += "\n" + strconv.Itoa(i+1) + ". " + products[i].Name
			if products[i].Weight != 0 {
				msg += ", " + strconv.FormatFloat(products[i].Weight, 'f', 0, 64) + "–≥—Ä."
			}
			rtime := products[i].Rest_time.String()
			if products[i].Rest_time > 0 {
				rtime = strings.ReplaceAll(rtime, "h", " —á–∞—Å–æ–≤, ")
				rtime = strings.ReplaceAll(rtime, "m", " –º–∏–Ω—É—Ç, ")
				rtime = strings.ReplaceAll(rtime, "s", " —Å–µ–∫—É–Ω–¥ ")
				msg += ", –∏—Å–ø–æ—Ä—Ç–∏—Ç—Å—è —á–µ—Ä–µ–∑: " + rtime
			} else {
				msg += ", —Å—Ä–æ–∫ –≥–æ–¥–Ω–æ—Å—Ç–∏ –≤—ã—à–µ–ª"
			}
		}
		db.SetStatus(0, user_id, chat_id)
		return msg
	} else if user_msg == "/statustime" {
		msg = "–í–≤–µ–¥–∏—Ç–µ –∑–∞ –∫–∞–∫–æ–π –ø—Ä–æ–º–µ–∂—É—Ç–æ–∫ –ø—Ä–æ–º–µ–∂—É—Ç–æ–∫ –≤—Ä–µ–º–µ–Ω–∏ –≤—ã —Ö–æ—Ç–∏—Ç–µ –ø—Ä–æ—Å–º–æ—Ç—Ä–µ—Ç—å —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É\n–ü—Ä–∏–º–µ—Ä: 30-12-2022 31-12-2022"
		db.SetStatus(6, user_id, chat_id)
		return msg
	}
	return msg
}
